
<html lang="en">
<head>
<style>

    .loader {
	position: fixed;
	left: 0px;
	top: 0px;
	width: 100%;
	height: 100%;
	z-index: 9999;
	background: url('/static/images/loading.gif') 50% 50% no-repeat rgb(249,249,249);
}
</style>
    <meta charset="UTF-8" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>PlanMyTrip</title>

    <!-- Google fonts -->
    <link href='http://fonts.googleapis.com/css?family=Roboto:400,300,700' rel='stylesheet' type='text/css'>

    <!-- font awesome -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

    <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
    <!-- bootstrap -->
    <link rel="stylesheet" href="/static/style/bootstrap.min.css" />

    <link rel="stylesheet" href="/static/style/set.css" />


    <!-- favicon -->


    <link rel="stylesheet" href="/static/style/style.css">
<style>
       #map {
        height: 400px;
        width: 100%;
       }
    </style>
    
    <!-- jquery for Adding Multiple Text Boxes Start-->
    <script type="text/javascript" src="/static/jquery-3.1.1.js"></script>
        <!-- jquery for Adding Multiple Text Boxes End-->
        
        <!-- JavaScript for Adding Multiple Text Box Start-->
        <script type="text/javascript">

</script>
<!-- JavaScript for Adding Multiple Text Box End-->
</head>

<body>

<img src="/static/images/loading.gif" id="gif" style="display: block; margin: 0 auto; width: 100px; visibility: hidden;">
<div class="topbar animated fadeInLeftBig"></div>

<!-- Header Starts -->

    <div class="container">
        <div class="navbar-inverse navbar-fixed-top" role="navigation" id="top-nav">
            <div class="container">
                <div class="navbar-header">
                    <!-- Logo Starts -->
                    <h1 style="font-size:250%;">Plan My Trip</h1>
                    <!-- #Logo Ends -->

                </div>
                <!-- Nav Starts -->
                  <div class="navbar-collapse  collapse">
                    <ul class="nav navbar-nav navbar-right scroll">
                   <li ><a href="{{ url_for("price") }}"><strong>Home</strong></a></li>
                    </ul>
                </div>
                <!-- #Nav Ends -->

            </div>
        </div>

    </div>

<!-- #Header Starts -->


                <div id="routeFinder"  class="container spacer about">
                    <div class="row">
                    <div class="col-xs-12 col-sm-8 col-md-6 col-sm-offset-2 col-md-offset-3">
                        <form name="myform" id="myform" method="POST" action={{ url_for("price") }}" >
                       <hr class="colorgraph">
                          
                            <h2 align="center" >Uber/Lyft ? Let us Decide for you</h2>
                            
                           
                   
                            
                                 <fieldset>
                                <div class="form-group">
                                    <input type="text"  id="source"  name="source" class="form-control input-lg" placeholder="Source" tabindex="1" required="required">
                                    
                                </div>
                                     <span id="result"></span>
                               </fieldset>
                                   <div id='TextBoxesGroup'>
                                    <div class="form-group" >
                                        <input type="text" id="destination1" name="destination1" class="form-control input-lg" placeholder="Destination" tabindex="2" required="required">
                                        </div>
                                        
                                    </div>
                                      <div class="row">
                                    <div class="col-xs-12 col-sm-6 col-md-6">
                                    <div class="form-group"><input type="button" id="addDestination" name="addDestination" value="Add Destination" class="btn btn-primary btn-block btn-md"  ></div>
                            </div>
                                   <div class="col-xs-12 col-sm-6 col-md-6">
                                    <div class="form-group"><input type="button" id="removeDestination" name="removeDestination" value="Remove Destination" class="btn btn-primary btn-block btn-md" ></div>
                            </div>
                            </div>
                                    
                                    
                           

                            <hr class="colorgraph">
                            <div class="col-xs-12 col-sm-6 col-md-6 col-sm-offset-2 col-md-offset-3"><div class="form-group"><input type="button" id="getloc" name="find" value="Get Locations" class="btn btn-primary btn-block"  ></div>
                                </div>

                              <div class="col-xs-12 col-sm-6 col-md-6 col-sm-offset-2 col-md-offset-3"><div class="form-group"><input type="submit" id="submit" name="submit" value="Find Route/Taxi" class="btn btn-primary btn-block"  ></div>
                                </div>
                                      
                          <input type="hidden"  id="latlong" name="latlong" class="form-control input-lg" >
                            <input type="hidden"  id="sourcelatlong" name="sourcelatlong" class="form-control input-lg" >
                              <input type="hidden"  id="sourceDestinationList" name="sourceDestinationList" class="form-control input-lg" >
                        </form>

                    </div>
                </div>
                
                
                <div id="map"></div>
                    <div class="loader"></div>
       <script type="text/javascript">

        var counter;
$(document).ready(function(){

     counter = 2;

    $("#addDestination").click(function () {

	if(counter>10){
            alert("A Maximum of 10 Locations are allowed");
            return false;
	}

	var newTextBoxDiv = $(document.createElement('div'))
	     .attr({ class: 'form-group'});

	newTextBoxDiv.after().html('<input type="text" name="destination' + counter +
	      '" id="destination' + counter + '" class="form-control input-lg" placeholder="Destination '+counter+ '" >');

	newTextBoxDiv.appendTo("#TextBoxesGroup");
        
        var input2 = document.getElementById('destination'+counter);
        var searchBox2 = new google.maps.places.SearchBox(input2);
      	counter++;


     });

     $("#removeDestination").click(function () {
	if(counter==2){
          alert("You Must have at least one destination");
          return false;
       }
console.log(counter);
	counter--;

        $("#destination" + counter).remove();

     });



         $("#submit").click(function () {
	    document.myform.action = "/price"
         document.myform.submit();             // Submit the page

    return true;

     });


  });
        
      function initMap() {
        var map = new google.maps.Map(document.getElementById('map'), {
          zoom: 5,
          center: {lat: 37.7749295, lng: -122.41941550000001}
        });

        var input = document.getElementById('source');
        var searchBox = new google.maps.places.SearchBox(input);
         
 
        var input2 = document.getElementById('destination1');
        var searchBox2 = new google.maps.places.SearchBox(input2);
          
        var geocoder = new google.maps.Geocoder();

        document.getElementById('getloc').addEventListener('click', function() {
          geocodeAddress(geocoder, map);
        //var geocoder = new google.maps.Geocoder();
         //for (i = 1; i < counter; i++) {


        //geocodeAddress(geocoder, i);


        });
      }

      function geocodeAddress(geocoder, resultsMap) {

        var address = document.getElementById('source').value;
        geocoder.geocode({'address': address}, function(results, status) {
          if (status === 'OK') {
            resultsMap.setCenter(results[0].geometry.location);

              var setLatLong = document.getElementById('sourcelatlong');
              setLatLong.value = results[0].geometry.location.lat()+ "," + results[0].geometry.location.lng();

              var sourceDestinationList = document.getElementById('sourceDestinationList');
                sourceDestinationList.value = '1:' + address;


            var marker = new google.maps.Marker({
              map: resultsMap,
              position:  {lat: results[0].geometry.location.lat(), lng: results[0].geometry.location.lng()},
                label : "1"

            });
              //  start = new google.maps.LatLng(marker.getPosition().lat(), marker.getPosition().lng());
               console.log(results[0].geometry.location);
          } else {
            alert('Geocode was not successful for the following reason: ' + status);
          }
        });





          for (var i = 1; i < counter; i++) {
    (function(i) {

              var Destaddress = document.getElementById('destination' + i).value;


              geocoder.geocode({'address': Destaddress}, function (results, status) {
                  if (status === 'OK') {
                      resultsMap.setCenter(results[0].geometry.location);

                       var sourceDestinationList = document.getElementById('sourceDestinationList');
                        sourceDestinationList.value = sourceDestinationList.value + ';' + (i+1)+ ':' + Destaddress;

                        var setLatLong = document.getElementById('latlong');
                        if(setLatLong.value.length < 1)
                        {
                            setLatLong.value = results[0].geometry.location.lat()+ "," + results[0].geometry.location.lng();
                        }
                        else {
                            setLatLong.value = setLatLong.value + ";" + results[0].geometry.location.lat() + "," + results[0].geometry.location.lng();
                        }


                            var marker = new google.maps.Marker({
                          map: resultsMap,
                          position: {lat: results[0].geometry.location.lat(), lng: results[0].geometry.location.lng()},


                      });
                      //  start = new google.maps.LatLng(marker.getPosition().lat(), marker.getPosition().lng());
                      console.log(results[0].geometry.location);
                  } else {
                      alert('Geocode was not successful for the following reason: ' + status);
                  }
              });


            })(i);
}
             }

          
      
   
        
        //REference : https://www.taniarascia.com/google-maps-apis-for-multiple-locations/
    </script>
                    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
                    <script type="text/javascript">
$(window).load(function() {
	$(".loader").fadeOut("slow");
})


                        $('#myform').submit(function()  {
	$(".loader").fadeOut("slow");
})
</script>
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDmjLulL2RJWCbb3ewYnwC9VfHNZRpRK-o&libraries=places&callback=initMap">
    </script>
         </div>   


</body>
</html>
